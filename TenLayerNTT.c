#include <stdio.h>
#include <stdint.h>

uint16_t logn = 10;
uint16_t n = 1024;
uint32_t p = 16760833;
uint32_t p0i = 4043292671; // p0i = -1/p mod 2^32
uint32_t r2 = 13696128; // r squared in modulo p, r = 2^32.
uint32_t inv2 = 2097024; // in Montgomery form

// omegas[1] = omega_2048 * r, they are stored in Montgomery form
uint32_t omegas[1024] = {
    4194048, 11004587, 14905352, 8230082, 10574562, 5361583, 15686626, 16716512, 
    15188767, 16648366, 14499861, 16335141, 16173776, 8542674, 5522700, 11800111, 
    7052443, 1620462, 16095881, 12837130, 5566309, 11664448, 9137146, 7820426, 
    6171053, 14682379, 12531175, 4385381, 5203054, 15140144, 5464186, 8601457, 
    3034156, 12342572, 2751753, 16050250, 5439418, 12660690, 14955863, 13019832, 
    14633048, 16315531, 11747571, 11638145, 12127683, 3749248, 12138874, 1800788, 
    8352680, 16536761, 10775318, 1468980, 648389, 2121156, 6508956, 10852011, 
    5826375, 10902300, 15309649, 8607738, 4327918, 13305824, 2090064, 10183533, 
    9406032, 4955001, 13335941, 2268104, 488445, 14729771, 16219491, 14164458, 
    832175, 5030800, 3072618, 3698952, 2803594, 9481973, 8450347, 13243506, 
    12272246, 14630741, 14807626, 12770715, 1802267, 10605328, 8579298, 2216410, 
    3948848, 15925590, 9550357, 4107457, 14780712, 11918181, 8180620, 367687, 
    3387958, 7592206, 4078389, 9185547, 6937297, 5716409, 6047685, 8238687, 
    13016815, 11375130, 8194257, 13749227, 13730318, 11244404, 6465904, 15972413, 
    8507638, 8777160, 9226256, 1070102, 3028066, 7010688, 12841356, 24382, 
    4101579, 4966724, 139937, 8119387, 4371632, 10950251, 7179587, 12036127, 
    11930405, 1153307, 3795421, 8077622, 15803946, 179523, 9233825, 8654634, 
    1741833, 14477648, 16659063, 6234716, 9585873, 7465670, 14330054, 2815640, 
    6217936, 12371140, 2157085, 1135523, 11046423, 1971956, 9858752, 3984404, 
    1677290, 4657448, 2128259, 7184827, 1817045, 16624679, 12465425, 3322742, 
    12000572, 9396730, 487889, 9723890, 5895198, 14038905, 7062087, 15617843, 
    12734227, 2233245, 771, 460351, 5303131, 11177168, 3298611, 2592351, 
    439068, 2725826, 11091395, 6541413, 11840270, 12813348, 5540363, 7107291, 
    15282356, 15768022, 5447246, 14769444, 15494575, 4176335, 16754507, 16418461, 
    14509801, 7313657, 10108964, 10425528, 5201807, 7982552, 14473926, 11545422, 
    11459888, 9649752, 14563325, 15445893, 11000366, 3580736, 4762149, 969673, 
    14433026, 4689906, 3095376, 8613473, 404379, 15404845, 7273866, 13328636, 
    5862917, 9329654, 10698709, 12096490, 9559167, 2215600, 4313035, 9506383, 
    11959950, 13424571, 5665940, 369971, 5382129, 323919, 6885199, 957347, 
    6855990, 15104037, 14600895, 8900104, 7873323, 10798490, 14391546, 10096750, 
    480588, 13234135, 9263932, 9044094, 14108349, 13830343, 8380812, 8399172, 
    5731211, 11559628, 12811630, 8340653, 2638267, 1811310, 3787385, 10366404, 
    14899773, 8855469, 12939845, 12874069, 12361122, 12827645, 4968183, 2815425, 
    10763466, 631469, 7866303, 8367833, 14627862, 8632112, 8598633, 12456665, 
    4157499, 12725227, 8142082, 10618099, 6748144, 15710881, 6742292, 5347201, 
    1295043, 7402016, 2475449, 8138701, 15055869, 10557938, 4848698, 14842345, 
    16218269, 6478316, 4970404, 6141542, 1692287, 6046701, 12281582, 1618192, 
    13805722, 9332171, 7766794, 322153, 10700305, 11875524, 4949932, 3178908, 
    2467394, 10829181, 2434078, 11241067, 9973426, 9867481, 3805049, 5652442, 
    810526, 10191467, 9273734, 2940206, 4094345, 7060455, 16599921, 16313238, 
    9943678, 1888043, 7299100, 16178064, 1689943, 5321050, 1071996, 13267617, 
    5342474, 668279, 627601, 5839394, 3827930, 7966497, 1931243, 15810515, 
    12145222, 1678036, 5646349, 12302901, 3434385, 14921719, 14176461, 15238077, 
    13307992, 6536707, 10769524, 6639897, 8034834, 15342860, 10415762, 10544583, 
    2265947, 12570073, 3284682, 12145108, 4088224, 2383973, 14628498, 11946633, 
    10038424, 10068071, 3422018, 8211505, 1069504, 15670982, 12245300, 14454751, 
    14683280, 10243066, 7821821, 10199629, 4321060, 7450163, 6962388, 11589143, 
    8956321, 9352652, 10539150, 16565435, 7939598, 761579, 5857295, 10864147, 
    659558, 637820, 7680125, 5747354, 5480982, 5477918, 3213674, 4921274, 
    5676356, 14806561, 1765279, 4846473, 11600796, 14001090, 2026833, 6146695, 
    10073392, 8251267, 15223783, 13816746, 10914425, 10375394, 9202356, 3538912, 
    681008, 16445244, 1371104, 8360322, 5817094, 5991206, 12298562, 11365358, 
    13663885, 7860918, 4891672, 11371019, 11304854, 2255312, 2763581, 634336, 
    14295521, 12196507, 6864711, 15093818, 12760164, 6980680, 10358838, 7251815, 
    10227554, 559865, 13243101, 4073923, 3040721, 7632006, 668439, 14005714, 
    4831223, 15560469, 2194526, 14077885, 4227744, 2558741, 7066702, 1851678, 
    5129612, 9093439, 10028005, 12455740, 6953016, 8601971, 8928001, 4704104, 
    4616254, 1488491, 7167652, 12953402, 11186136, 14827151, 2233157, 1861267, 
    3528970, 9744776, 105044, 8350541, 11477000, 16606174, 1438143, 15692589, 
    7972597, 7051707, 420141, 620468, 5797783, 12004376, 12776727, 8783227, 
    15044406, 1496189, 12024866, 15358805, 8523232, 14305472, 2942461, 6701634, 
    10136154, 5442870, 6721838, 2004011, 2585262, 16228042, 987546, 5300386, 
    2168626, 8548196, 6102407, 7803640, 9083172, 9202090, 9162684, 4242686, 
    5110804, 4472183, 13726800, 1817795, 768179, 406759, 15369384, 2752843, 
    9766303, 14284534, 9831999, 16488841, 1489145, 10101617, 14908305, 12841088, 
    5690438, 2019078, 2494575, 6036801, 3696553, 3240753, 2285378, 4019863, 
    6240597, 2575602, 2568933, 9478267, 2998434, 13339611, 8481129, 16122949, 
    10433796, 14768914, 9939002, 183037, 1984169, 3064001, 1510403, 13207472, 
    3104756, 11431509, 6248582, 1365062, 2013622, 519496, 11922016, 10905215, 
    3963218, 13810044, 1760612, 2951189, 6543421, 2908800, 14407510, 7802522, 
    15959095, 5142633, 1976785, 8329032, 13677787, 15639828, 469848, 5647553, 
    3608766, 15541877, 9767431, 7197191, 8590685, 12884951, 184707, 198695, 
    6159393, 9785604, 8482784, 14654605, 13099928, 14087549, 1041452, 5356378, 
    8404905, 1849956, 8014470, 10096890, 14281541, 6066673, 9054383, 14469140, 
    12166036, 14170939, 14658370, 543630, 4505978, 3187896, 13573094, 16629278, 
    15798365, 847194, 5954929, 8268578, 1212114, 799469, 9306899, 5720762, 
    14581557, 15484108, 7578820, 2151040, 11613082, 5662973, 12815786, 4278666, 
    15419962, 6126079, 10155206, 4905478, 4418728, 4135766, 2900989, 11939342, 
    13337249, 8136034, 4398251, 1278842, 14706898, 13736300, 2098791, 10046462, 
    7737005, 9970370, 7434101, 11328532, 4480026, 15518424, 2785767, 881248, 
    6701080, 5087989, 762756, 14494827, 5438138, 6200784, 6260398, 2963685, 
    10526317, 2946560, 3844741, 4525828, 2540021, 584950, 2481854, 6810855, 
    13980726, 13541696, 10012474, 5595482, 15039703, 362017, 5937267, 12940256, 
    4184707, 7362013, 10177225, 8683104, 3219081, 7932311, 3975836, 15213616, 
    10876631, 4896158, 332172, 8603, 2484537, 369368, 1369922, 16589333, 
    5513072, 14225291, 5285030, 8369351, 16055972, 1790725, 3213797, 2320808, 
    9196288, 14502737, 5813248, 3499173, 2801296, 7783790, 9731047, 5429401, 
    6549275, 13230196, 8738105, 13646249, 11982904, 14195260, 3288778, 9351641, 
    15152879, 4394144, 4304871, 14501341, 1805814, 2657986, 3933037, 14985092, 
    15211135, 13047434, 939886, 7278126, 7067881, 10446926, 5347782, 5772374, 
    12854798, 767779, 8863559, 9509395, 15323578, 15815814, 678762, 13647677, 
    15313794, 4778313, 11207878, 7700278, 15454286, 1163890, 14701297, 14826811, 
    9421437, 14479151, 1643470, 15724902, 12005304, 9917784, 12992335, 9345467, 
    11596923, 12079891, 8517732, 13260641, 1981569, 7750702, 5322557, 2732668, 
    524495, 6798156, 14289656, 2107673, 6632381, 16090609, 6971923, 11130169, 
    8062322, 4059886, 14876814, 8190490, 9586976, 906877, 1199418, 1044973, 
    14719561, 14188482, 12502590, 5339463, 14044342, 9438864, 14775843, 14293581, 
    2929488, 12803472, 13208759, 9416668, 14740351, 10427960, 4066962, 16123519, 
    15143689, 14319961, 15071850, 7904296, 9639811, 6845118, 10308199, 5168241, 
    13679938, 3685052, 11743233, 2787143, 5311522, 1382976, 8774993, 4758471, 
    11686617, 9743472, 10913379, 15729093, 7203347, 12527197, 4684092, 8689133, 
    9840627, 1683995, 13747835, 9638316, 4930742, 6633896, 821312, 44684, 
    10658353, 10500559, 11175540, 4196121, 698887, 7185752, 15782361, 3987102, 
    11679506, 9236737, 14132462, 6858287, 62529, 2117689, 12764938, 6613770, 
    7304379, 5134444, 7500293, 3046407, 4744425, 6952155, 10044400, 1049310, 
    6830872, 9802137, 10919591, 1720820, 6192003, 7539137, 3087376, 10141143, 
    530430, 15407050, 10938255, 9386524, 15133145, 2589547, 9438737, 700044, 
    16246124, 4197061, 14347073, 11738268, 7192175, 14073959, 3427071, 1945977, 
    5999281, 9185242, 13385607, 8162011, 8300006, 7194658, 11860872, 13027522, 
    2898565, 12905051, 11012165, 5538773, 7201405, 3302462, 4978674, 15666365, 
    9292916, 16415187, 16685377, 3011617, 2797953, 11418164, 3454411, 10552852, 
    11811912, 8968196, 9703897, 9566379, 586993, 9571247, 14993568, 3619873, 
    15369345, 3577381, 8650227, 11110462, 5686891, 9966420, 7140836, 10028952, 
    9195099, 6118909, 10895849, 849194, 13953428, 4046857, 5401771, 4073580, 
    10292427, 3403205, 3695959, 15799101, 2047515, 4669509, 15307925, 11534880, 
    16448023, 9660818, 15257615, 2495588, 1380788, 4751190, 14774022, 2510664, 
    1099823, 11578338, 2743969, 13011248, 11746813, 10902948, 1609633, 10390937, 
    15808910, 12556466, 6029715, 2661268, 1588325, 8342182, 3833815, 871658, 
    8322864, 9994979, 6736446, 11617502, 12780331, 16391624, 12029333, 4721656, 
    2270196, 6541880, 1966956, 15003754, 6158290, 16344397, 4852587, 16425272, 
    4598303, 12270207, 7456780, 1152438, 5406986, 11143881, 3097379, 16548546, 
    13029343, 14681482, 14734716, 12237299, 16003563, 3606825, 6296000, 4503686, 
    1362861, 15025498, 15749966, 1688039, 12053752, 8040981, 2708817, 1957347, 
    266403, 16108495, 14325270, 3393970, 14573166, 8517467, 2102438, 16745753, 
    365533, 15406160, 12993802, 11851819, 3296052, 6412230, 11011477, 3323636, 
    9860457, 1458960, 11361233, 309637, 7140249, 5678473, 3570613, 891786, 
    1797513, 10549398, 1032215, 16275869, 12239925, 10767170, 6125666, 2126019, 
    4260408, 15931439, 3216630, 9468854, 878084, 6551036, 9520800, 8850730
};

uint32_t f[1024] = {
    2, 1, 0, 0, 0, 1, 2, 2, 2, 2, 0, 0, 2, 2, 1, 0, 4, 3, 0, 4, 0, 3, 3, 1, 2, 0, 1, 2, 2, 0, 0, 4, 
    4, 5, 4, 2, 3, 3, 2, 3, 1, 3, 0, 3, 2, 2, 2, 1, 6, 2, 4, 2, 1, 2, 2, 8, 2, 1, 0, 1, 1, 0, 0, 0, 
    1, 4, 0, 0, 0, 0, 7, 2, 3, 3, 3, 2, 1, 1, 1, 0, 1, 2, 8, 0, 2, 2, 0, 3, 1, 0, 0, 7, 1, 4, 0, 1, 
    1, 0, 5, 4, 3, 1, 0, 0, 4, 2, 1, 0, 2, 7, 0, 3, 0, 0, 0, 2, 0, 3, 0, 1, 7, 1, 1, 7, 2, 0, 2, 4, 
    0, 1, 3, 0, 3, 1, 2, 0, 0, 0, 1, 0, 1, 2, 0, 3, 0, 2, 0, 2, 1, 3, 1, 0, 3, 3, 3, 3, 1, 0, 0, 0, 
    3, 4, 2, 1, 3, 2, 2, 3, 2, 0, 3, 3, 0, 0, 5, 1, 4, 3, 0, 0, 1, 4, 1, 3, 5, 4, 2, 0, 0, 4, 1, 1, 
    0, 2, 0, 4, 3, 5, 1, 5, 2, 5, 1, 4, 5, 0, 1, 2, 2, 0, 1, 5, 3, 0, 1, 1, 4, 4, 0, 3, 1, 4, 1, 3, 
    3, 0, 5, 1, 0, 0, 1, 2, 3, 2, 1, 1, 1, 2, 2, 2, 2, 3, 1, 3, 1, 4, 1, 0, 7, 2, 3, 0, 1, 3, 0, 3, 
    1, 0, 5, 2, 0, 0, 1, 4, 0, 1, 0, 2, 0, 2, 2, 3, 2, 7, 1, 1, 3, 0, 0, 3, 6, 1, 4, 5, 0, 4, 3, 1, 
    2, 1, 3, 0, 4, 1, 5, 3, 7, 7, 1, 4, 2, 1, 4, 0, 0, 4, 4, 1, 2, 0, 3, 1, 0, 1, 4, 5, 1, 2, 0, 0, 
    1, 5, 2, 1, 4, 1, 4, 0, 7, 3, 0, 1, 1, 1, 4, 5, 1, 1, 1, 2, 2, 6, 3, 5, 0, 0, 3, 4, 2, 0, 5, 3, 
    1, 1, 3, 1, 1, 0, 4, 5, 2, 4, 3, 5, 2, 1, 2, 3, 1, 4, 4, 3, 0, 1, 1, 2, 4, 4, 2, 1, 0, 6, 1, 0, 
    3, 0, 3, 1, 5, 2, 3, 0, 2, 1, 1, 0, 3, 1, 0, 3, 3, 0, 0, 1, 2, 1, 4, 2, 5, 0, 1, 0, 2, 3, 5, 0, 
    1, 6, 2, 2, 1, 2, 0, 2, 1, 1, 1, 1, 1, 5, 7, 3, 0, 2, 1, 1, 2, 0, 2, 1, 3, 4, 3, 0, 2, 3, 1, 3, 
    5, 1, 0, 0, 5, 0, 3, 2, 2, 3, 2, 0, 2, 1, 3, 1, 7, 2, 0, 0, 3, 3, 5, 5, 5, 2, 2, 1, 1, 0, 1, 2, 
    4, 4, 1, 0, 0, 0, 2, 0, 1, 0, 1, 1, 3, 1, 4, 0, 1, 1, 2, 3, 4, 6, 3, 0, 0, 7, 2, 0, 3, 1, 0, 1, 
    1, 3, 0, 3, 1, 4, 2, 1, 2, 1, 0, 8, 1, 3, 5, 0, 4, 3, 2, 1, 0, 3, 2, 1, 0, 1, 1, 0, 4, 1, 1, 5, 
    0, 1, 0, 1, 6, 3, 0, 3, 0, 4, 2, 1, 3, 1, 3, 4, 6, 1, 1, 0, 0, 1, 1, 0, 0, 5, 0, 1, 2, 0, 1, 2, 
    2, 0, 1, 1, 0, 0, 0, 4, 0, 3, 3, 1, 0, 2, 2, 0, 5, 2, 4, 1, 1, 2, 5, 1, 4, 0, 4, 0, 1, 5, 1, 1, 
    3, 3, 1, 0, 3, 3, 0, 4, 0, 2, 4, 1, 0, 1, 4, 2, 5, 7, 0, 4, 0, 2, 2, 1, 2, 1, 4, 3, 0, 0, 1, 6, 
    2, 9, 0, 3, 4, 1, 4, 4, 1, 0, 4, 5, 2, 0, 2, 0, 2, 6, 1, 0, 1, 1, 0, 0, 0, 9, 4, 4, 3, 5, 2, 1, 
    3, 7, 4, 5, 4, 3, 1, 2, 2, 0, 0, 1, 1, 1, 1, 7, 0, 0, 6, 1, 5, 0, 6, 0, 3, 0, 2, 2, 2, 4, 1, 8, 
    0, 8, 2, 0, 1, 2, 0, 0, 0, 1, 5, 3, 0, 1, 2, 3, 0, 2, 0, 4, 0, 3, 2, 1, 3, 4, 2, 1, 2, 2, 1, 0, 
    3, 1, 3, 1, 1, 3, 5, 1, 0, 5, 2, 1, 2, 5, 5, 0, 1, 6, 0, 9, 2, 2, 1, 3, 0, 2, 2, 2, 2, 1, 3, 7, 
    3, 0, 1, 5, 0, 4, 0, 0, 1, 5, 0, 1, 4, 1, 4, 0, 3, 2, 3, 4, 0, 1, 3, 2, 3, 1, 2, 5, 1, 0, 0, 1, 
    1, 7, 0, 0, 2, 0, 2, 0, 1, 4, 2, 2, 3, 2, 4, 1, 0, 1, 0, 1, 0, 4, 5, 1, 3, 4, 4, 0, 1, 1, 1, 3, 
    10, 5, 1, 1, 6, 0, 0, 0, 2, 1, 0, 1, 0, 1, 1, 5, 0, 2, 0, 2, 0, 3, 2, 3, 2, 3, 1, 3, 4, 6, 5, 2, 
    2, 0, 0, 1, 1, 2, 0, 3, 0, 3, 2, 1, 3, 1, 1, 4, 5, 9, 4, 2, 4, 2, 2, 1, 0, 1, 2, 6, 7, 2, 2, 2, 
    0, 1, 2, 3, 0, 3, 3, 0, 2, 0, 1, 3, 2, 2, 0, 1, 1, 3, 0, 1, 4, 4, 2, 1, 3, 2, 1, 0, 2, 3, 0, 2, 
    5, 4, 1, 2, 6, 0, 2, 2, 0, 0, 1, 7, 3, 0, 0, 4, 0, 3, 0, 0, 2, 3, 2, 1, 0, 2, 1, 2, 3, 1, 2, 0, 
    1, 3, 2, 1, 5, 0, 1, 4, 2, 0, 2, 0, 0, 2, 7, 5, 4, 3, 2, 1, 1, 0, 2, 0, 1, 0, 5, 3, 1, 1, 4, 2, 
    0, 4, 0, 0, 1, 4, 0, 2, 5, 1, 0, 3, 4, 3, 6, 2, 0, 3, 6, 1, 2, 1, 2, 1, 3, 0, 0, 2, 0, 0, 2, 3
};

uint32_t g[1024] = {
    4, 4, 3, 3, 2, 0, 0, 5, 2, 1, 4, 3, 4, 2, 1, 0, 2, 0, 2, 3, 2, 2, 0, 1, 1, 0, 0, 1, 3, 0, 0, 0, 
    4, 1, 2, 4, 3, 3, 0, 1, 0, 1, 3, 1, 0, 0, 1, 0, 0, 0, 6, 2, 0, 3, 1, 7, 6, 3, 0, 4, 0, 0, 6, 1, 
    5, 2, 0, 1, 0, 0, 5, 1, 1, 2, 6, 1, 1, 3, 1, 2, 0, 3, 2, 4, 2, 5, 2, 1, 1, 0, 0, 1, 2, 2, 1, 0, 
    1, 1, 1, 5, 4, 2, 4, 4, 2, 1, 3, 2, 3, 0, 2, 0, 4, 0, 3, 2, 1, 1, 2, 1, 1, 4, 1, 0, 3, 1, 1, 2, 
    2, 0, 0, 1, 2, 0, 2, 1, 1, 0, 1, 0, 2, 4, 4, 4, 2, 2, 3, 1, 2, 1, 5, 2, 0, 0, 2, 2, 2, 1, 0, 0, 
    1, 5, 0, 1, 2, 1, 0, 0, 0, 2, 3, 0, 2, 1, 0, 3, 1, 1, 2, 0, 5, 8, 0, 3, 0, 0, 4, 3, 1, 1, 8, 3, 
    1, 1, 3, 4, 0, 1, 1, 1, 1, 8, 3, 1, 1, 3, 1, 2, 2, 3, 1, 1, 1, 1, 1, 0, 3, 6, 0, 6, 0, 0, 5, 1, 
    0, 3, 2, 2, 6, 3, 1, 5, 3, 5, 1, 2, 0, 6, 4, 11, 2, 2, 1, 2, 3, 0, 1, 8, 2, 1, 3, 1, 4, 0, 0, 1, 
    1, 1, 3, 0, 4, 2, 0, 3, 2, 2, 1, 6, 3, 0, 4, 1, 4, 2, 1, 2, 4, 2, 5, 0, 1, 3, 0, 2, 3, 0, 1, 1, 
    2, 1, 0, 4, 0, 1, 1, 3, 2, 1, 4, 2, 2, 2, 0, 3, 6, 2, 0, 1, 4, 2, 3, 2, 3, 2, 2, 3, 1, 4, 3, 0, 
    2, 6, 1, 4, 6, 3, 4, 3, 3, 0, 6, 4, 5, 0, 2, 2, 2, 0, 2, 2, 3, 3, 0, 0, 0, 2, 6, 3, 0, 4, 2, 5, 
    0, 6, 3, 5, 3, 3, 1, 0, 5, 0, 2, 0, 5, 0, 3, 2, 0, 0, 1, 0, 3, 4, 1, 0, 0, 2, 0, 1, 1, 0, 0, 4, 
    2, 6, 0, 0, 0, 0, 1, 2, 1, 1, 2, 2, 0, 5, 0, 0, 1, 0, 5, 2, 3, 1, 0, 0, 2, 0, 0, 3, 1, 1, 2, 3, 
    3, 1, 1, 0, 0, 0, 3, 3, 0, 5, 3, 3, 0, 2, 1, 1, 3, 3, 0, 0, 1, 2, 0, 0, 0, 2, 0, 0, 3, 3, 2, 3, 
    0, 4, 2, 1, 3, 4, 4, 0, 2, 5, 1, 6, 4, 2, 1, 0, 1, 1, 0, 0, 1, 4, 4, 3, 4, 1, 3, 1, 7, 0, 2, 3, 
    1, 5, 3, 5, 1, 7, 1, 0, 1, 2, 0, 0, 0, 0, 3, 0, 4, 2, 3, 0, 1, 2, 1, 4, 4, 3, 2, 7, 3, 0, 5, 1, 
    1, 5, 3, 2, 1, 3, 3, 0, 1, 2, 1, 3, 3, 1, 4, 1, 1, 4, 1, 0, 7, 0, 4, 3, 7, 0, 2, 3, 3, 2, 2, 0, 
    1, 0, 4, 3, 0, 0, 0, 2, 0, 2, 2, 0, 0, 1, 1, 0, 3, 4, 3, 1, 3, 2, 3, 1, 1, 1, 6, 0, 1, 1, 3, 4, 
    1, 0, 0, 1, 0, 3, 1, 1, 0, 2, 1, 0, 4, 3, 1, 3, 1, 4, 2, 0, 8, 1, 2, 4, 2, 5, 2, 3, 1, 2, 2, 0, 
    4, 0, 2, 0, 0, 2, 3, 2, 0, 3, 4, 2, 0, 1, 4, 2, 1, 1, 1, 2, 1, 0, 0, 0, 5, 0, 3, 7, 2, 0, 0, 0, 
    1, 2, 4, 4, 10, 0, 1, 0, 0, 2, 1, 2, 2, 2, 3, 0, 1, 0, 0, 2, 1, 1, 0, 4, 4, 2, 5, 0, 3, 1, 4, 5, 
    6, 0, 2, 0, 4, 0, 1, 6, 0, 1, 2, 2, 3, 1, 0, 0, 1, 0, 0, 0, 0, 0, 3, 0, 4, 0, 3, 1, 2, 1, 3, 1, 
    3, 1, 0, 5, 0, 1, 2, 1, 0, 2, 3, 0, 0, 0, 2, 1, 2, 4, 0, 0, 0, 2, 4, 3, 0, 1, 0, 1, 3, 1, 0, 0, 
    2, 0, 8, 3, 1, 2, 7, 3, 7, 2, 0, 1, 0, 1, 2, 4, 0, 3, 0, 4, 0, 8, 0, 0, 0, 3, 1, 2, 1, 2, 0, 4, 
    7, 0, 1, 2, 3, 0, 0, 0, 1, 2, 4, 5, 1, 0, 6, 2, 1, 1, 1, 1, 3, 1, 1, 3, 2, 4, 1, 3, 3, 4, 0, 4, 
    0, 2, 0, 5, 1, 0, 3, 2, 0, 0, 2, 2, 1, 0, 1, 2, 7, 2, 4, 4, 1, 1, 0, 0, 1, 4, 2, 2, 5, 2, 0, 6, 
    5, 2, 1, 2, 3, 5, 0, 1, 5, 1, 2, 0, 2, 2, 0, 3, 5, 4, 2, 0, 0, 0, 3, 1, 3, 3, 1, 0, 4, 4, 1, 1, 
    2, 2, 5, 0, 3, 0, 1, 1, 2, 1, 0, 3, 4, 3, 2, 1, 1, 0, 0, 1, 2, 6, 0, 1, 2, 5, 2, 0, 1, 6, 3, 3, 
    3, 0, 3, 2, 3, 0, 4, 0, 2, 5, 3, 1, 4, 0, 2, 4, 1, 2, 2, 1, 3, 3, 0, 2, 2, 6, 4, 1, 4, 1, 0, 1, 
    0, 4, 8, 5, 0, 1, 0, 4, 1, 0, 0, 3, 0, 1, 0, 2, 2, 5, 1, 7, 4, 2, 3, 2, 1, 0, 0, 6, 4, 2, 4, 2, 
    3, 0, 7, 6, 1, 0, 1, 3, 6, 4, 4, 3, 1, 0, 1, 1, 2, 0, 4, 1, 1, 2, 0, 3, 2, 3, 0, 5, 2, 3, 0, 4, 
    3, 2, 1, 2, 2, 3, 0, 4, 2, 1, 3, 0, 0, 0, 0, 2, 1, 1, 1, 0, 5, 1, 0, 2, 2, 1, 6, 0, 2, 2, 0, 7
};



static inline uint32_t tbmask(uint32_t x) {
	return (uint32_t)(*(int32_t *)&x >> 31);
}
static inline uint32_t mp_montymul(uint32_t a, uint32_t b, uint32_t p, uint32_t p0i) {
	uint64_t z = (uint64_t)a * (uint64_t)b;
	uint32_t w = (uint32_t)z * p0i;
	uint32_t d = (uint32_t)((z + (uint64_t)w * (uint64_t)p) >> 32) - p;
	return d + (p & tbmask(d));
}

static inline uint32_t mp_add(uint32_t a, uint32_t b, uint32_t p) {
	uint32_t d = a + b - p;
	return d + (p & tbmask(d));
}
static inline uint32_t mp_sub(uint32_t a, uint32_t b, uint32_t p) {
	uint32_t d = a - b;
	return d + (p & tbmask(d));
}


void print_call(uint32_t *f, uint16_t times){
    printf("%d: \n",times);
    for (size_t i = 0; i < n; i++){printf("%d, ",f[i]);}
    printf("\n");
}

void to_mont_form(uint32_t *f){
    for (size_t i = 0; i < n; i++) {
        f[i] = mp_montymul(f[i], r2,p,p0i);
    }
}

void de_mont_form(uint32_t *f) {
    for (size_t i = 0; i < n; i++) {
        f[i] = mp_montymul(f[i], 1, p, p0i);  // Multiply by 1 in Montgomery form
    }
}

void twist_0(uint32_t *f){
    for (size_t i = 0; i < n; i++) {
        f[i] = mp_montymul(f[i], omegas[i],p,p0i);
    }
}

void twist_inv_0(uint32_t *f){
    f[0] = mp_montymul(f[0], omegas[0],p,p0i);
    for (size_t i = 1; i < n; i++) {
        f[i] = p - mp_montymul(f[i], omegas[n-i],p,p0i);
    }

}

void CTButterfly(int layer, uint32_t *f) {
    uint32_t f_tmp[n];
    for (size_t i = 0; i < n; i++) {
        f_tmp[i] = f[i];
    }

    uint16_t d = n >> layer;  // d = n / (2^layer)

    for (size_t i = 0; i < n; i += (n >> (layer - 1))) {
        for (size_t j = 0; j < (n >> layer); j++) {
            f[i + j] = mp_add(f_tmp[i + j], f_tmp[i + d + j], p);
            f[i + d + j] = mp_sub(f_tmp[i + j], f_tmp[i + d + j], p);
        }
    }
}

void CTButterfly_inv(int layer, uint32_t *f) {
    uint32_t f_tmp[n];
    for (size_t i = 0; i < n; i++) {
        f_tmp[i] = f[i];
    }

    uint16_t d = n >> layer;  // d = n / (2^layer)

    for (size_t i = 0; i < n; i += (n >> (layer - 1))) {
        for (size_t j = 0; j < (n >> layer); j++) {
            f[i + j] = mp_add(f_tmp[i + j], f_tmp[i + d + j], p);
            f[i + d + j] = mp_sub(f_tmp[i + j], f_tmp[i + d + j], p);
        }
    }

    // Apply the inverse operation by multiplying by inv2 (1/2 in Montgomery form)
    for (size_t i = 0; i < n; i++) {
        f[i] = mp_montymul(f[i], inv2, p, p0i);
    }
}

void twist(int layer, uint32_t *f) {
    int range_end = n >> layer;  // equivalent to n / (2^layer)
    int step = n >> (layer - 1); // equivalent to n / (2^(layer-1))

    for (size_t i = 1; i < range_end; i++) {
        for (size_t j = (n >> layer); j < n; j += step) {
            int index = i + j;
            int omega_index = ((1 << layer) * i);
            f[index] = mp_montymul(f[index], omegas[omega_index], p, p0i);
        }
    }
}

void twist_inv(int layer, uint32_t *f) {
    int range_end = n >> layer;  // equivalent to n / (2^layer)
    int step = n >> (layer - 1); // equivalent to n / (2^(layer-1))

    for (size_t i = 1; i < range_end; i++) {
        for (size_t j = (n >> layer); j < n; j += step) {
            int index = i + j;
            int omega_index = n - ((1 << layer) * i);

            // Calculate -f[index] in Montgomery form: p - f[index]
            f[index] = mp_montymul(f[index], omegas[omega_index], p, p0i);
            f[index] = p - f[index];
        }
    }
}

void Forward_Trans(int logn, uint32_t *f) {
    // Apply initial twisting
    twist_0(f);

    // Perform layer-wise butterfly and twist operations
    for (int i = 1; i < logn; i++) {
        CTButterfly(i, f);
        twist(i, f);
    }

    // Final butterfly operation for the last layer
    CTButterfly(logn, f);
}

void Backward_Trans(int logn, uint32_t *f) {
    // Apply the inverse butterfly operation for the last layer
    CTButterfly_inv(logn, f);

    // Perform layer-wise inverse twist and butterfly operations
    for (int i = logn - 1; i > 0; i--) {
        twist_inv(i, f);
        CTButterfly_inv(i, f);
    }

    // Apply the inverse of the initial twisting
    twist_inv_0(f);
}



int main() {

    to_mont_form(f);
    to_mont_form(g);
    Forward_Trans(logn,f);
    Forward_Trans(logn,g);

    // Point-wise multiplication
    // Now f and g are stored in NTT domain

    uint32_t h[n];
    for (size_t i = 0; i < n; i++)
    {
        h[i] = mp_montymul(f[i],g[i],p,p0i);
    }

    


    Backward_Trans(logn,h);
    de_mont_form(h);
    print_call(h,1);







    return 0;

}
